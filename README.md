# java-shareit
ShareIt — бронирование вещей и интеграция с базой данных (спринт 2)
На этом этапе я сосредоточилась на интеграции с базой данных и реализации ключевого пользовательского сценария — бронирования вещей. Проект перешёл от хранения данных в памяти к полноценной работе с PostgreSQL с использованием Spring Data JPA и аннотаций Hibernate.

 Цель спринта
Перевести сущности User и Item на JPA и подключить PostgreSQL;

Реализовать сущность Booking и всю логику аренды вещей;

Добавить отображение бронирований при просмотре вещей;

Реализовать возможность оставлять отзывы;

Обеспечить безопасность доступа к бронированиям и комментариям.

 Что я сделала
1. Настройка базы данных и переход на JPA
Перешла в новую ветку add-bookings;

Подключила зависимости: spring-boot-starter-data-jpa, postgresql;

Настроила подключение к PostgreSQL через application.properties;

Создала schema.sql, добавив DDL-скрипты для users, items, bookings, comments;

Использовала CREATE TABLE IF NOT EXISTS, чтобы избежать ошибок при повторных запусках;

Добавила аннотации JPA (@Entity, @Table, @Id, @Column, @ManyToOne, @Enumerated) в модели User, Item, Booking, Comment;

Создала JpaRepository для User, Item, Booking и Comment.

2. Реализация логики бронирования (/bookings)
Создала модель Booking, DTO BookingDto, маппер BookingMapper;

Реализовала контроллер BookingController и методы:

POST /bookings — создание бронирования (со статусом WAITING);

PATCH /bookings/{bookingId}?approved={approved} — подтверждение или отклонение владельцем (APPROVED / REJECTED);

GET /bookings/{bookingId} — просмотр конкретного бронирования автором или владельцем;

GET /bookings — получение бронирований пользователя по фильтру state;

GET /bookings/owner — получение бронирований для своих вещей;

Написала логику фильтрации бронирований по состояниям: ALL, CURRENT, PAST, FUTURE, WAITING, REJECTED;

Реализовала сортировку бронирований по убыванию даты начала;

В сервисе BookingServiceImpl добавила проверку прав доступа: автор или владелец.

3. Отображение дат бронирования у вещей
В ItemServiceImpl доработала метод GET /items, чтобы:

возвращать последнее прошедшее бронирование (lastBooking);

и ближайшее будущее бронирование (nextBooking);

Эти данные доступны только владельцу вещи.

4. Добавление комментариев (/items/{itemId}/comment)
Создала сущность Comment и таблицу comments в schema.sql;

Реализовала добавление отзыва только при условии, что пользователь действительно арендовал вещь;

Создала DTO CommentDto, маппер CommentMapper;

Добавила метод в ItemController: POST /items/{itemId}/comment;

Обеспечила отображение комментариев в GET /items/{itemId} и GET /items.

5. Обновление репозиториев и сервисов
Перевела UserService, ItemService, BookingService на работу с JPA;

Использовала Optional, чтобы обрабатывать отсутствие сущностей;

Покрыла все сценарии соответствующими DTO и мапперами;

Провела рефакторинг и удаление in-memory логики.

6. Тестирование
Проверила все эндпоинты через Postman-коллекцию;

Тестировала пограничные случаи: бронирование своих вещей, попытка повторного комментария, одновременные брони;

Убедилась, что возвращаются корректные HTTP-статусы:

200 OK — при успешных действиях;

404 NOT FOUND — при отсутствии сущностей;

400 BAD REQUEST — при попытке несанкционированных действий.

 Технологии
Java 11

Spring Boot

Spring Data JPA

PostgreSQL

Hibernate

Lombok

Postman (тестирование)

 Архитектурные подходы
Перевела проект на JPA-ориентированную архитектуру с использованием JpaRepository;

Чётко разделила ответственность между слоями: контроллер → сервис → репозиторий;

Ввела строгую проверку прав доступа и целостности данных;

DTO и мапперы обеспечили независимость между API и моделью данных.

 Результат
В рамках второго спринта я реализовала полноценную функциональность бронирования, перевела проект на работу с базой данных PostgreSQL и расширила взаимодействие пользователей — теперь они могут не только арендовать вещи, но и делиться отзывами.

Проект готов к следующему этапу — добавлению логики для обработки запросов вещей и подготовки к интеграционным тестам.
